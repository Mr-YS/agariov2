<!DOCTYPE html>
<html>
<head>
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<link rel="stylesheet" href="http://meyerweb.com/eric/tools/css/reset/reset.css" />
	<style>
		body {
			overflow: hidden;
		}
	</style>
</head>
<body>
	<canvas id="main" />
	<script>
		var ctx = $('#main')[0].getContext('2d');
		var mapWidth = 10000;
		var mapHeight = 10000;
		var w = window.innerWidth;
		var h = window.innerHeight;
		var targetX = w/2;
		var targetY = h/2;
		var currX = w/2;
		var currY = h/2;
		var food = [];
		var limit = 10;
		var mass = 10;
		var colorList = [
			'Yellow',
			'Aqua',
			'Blue',
			'Chartreuse',
			'DarkOrange',
			'DarkOrchid',
			'DeepPink',
			'Fuchsia',
			'Gold',
			'Red'
		];
		var cellColor = colorList[Math.floor(Math.random() * colorList.length)];
		
		$('#main').mousemove( function(event) {
			targetX = event.pageX;
			targetY = event.pageY;
		});
		$(document).ready( function() {
			init();
			canvasResize();
			setInterval(draw,16);
			setInterval(regenerateFood,500);
			setInterval(naturalLoss, 5000);
		});
		$(window).resize( function() {
			canvasResize();
		});
		function canvasResize() {
			w = window.innerWidth;
			h = window.innerHeight;
			ctx.canvas.width = w;
			ctx.canvas.height = h;
		}
		function init() {
		}
		function draw() {
			ctx.clearRect(0,0 , ctx.canvas.width, ctx.canvas.height);
			currX = currX+(targetX-currX)/mass;
			currY = currY+(targetY-currY)/mass;
			if(currX < 0 || currX > mapWidth || currY < 0 || currY > mapHeight){
				return -1;
			}
			eatFood();
			circle(currX, currY, mass, cellColor);
			drawText(currX,currY);
			for(var i=0;i<food.length;++i) {
				circle(food[i].x, food[i].y, food[i].size, food[i].color);
			}
		}
		function naturalLoss() {
			if(mass >= 128) {
				mass -= Math.round((Math.random()+2*6)+mass/200);
			}
		}
		function eatFood() {
			var index = [];
			for(var i=0;i<food.length;++i) {
				var d = Math.sqrt(Math.pow(currX-food[i].x,2)+Math.pow(currY-food[i].y,2));
				if(d <= mass+food[i].size) {
					index.push(i);	
				}
			}
			for(var i=0;i<index.length;++i) {
				var f = food.splice(index[i],1)[0];
				mass += Math.round(f.size);
			}
		}
		function regenerateFood() {
			if(food.length < limit) {
				var p = {color : colorList[Math.floor(Math.random()*colorList.length)], x : Math.random()*mapWidth , y : Math.random()*mapHeight, size : Math.random()*2+1};
				var d = Math.sqrt(Math.pow(currX-p.x,2)+Math.pow(currY-p.y,2));
				if(d > mass+p.size) {
					food.push(p);		
				}
			}
		}
		function circle(x,y,r,color) {
			ctx.beginPath();
			ctx.arc(x, y, r, 0, 2*Math.PI);
			ctx.strokeStyle = color;
			ctx.fillStyle = color;
			ctx.fill();
			ctx.stroke();
		}
		function drawText(x,y) {
			ctx.font = '24px Arial';
			ctx.strokeStyle = 'black';
			ctx.strokeText(mass,x,y);
		}
	</script>
</body>
</html>
